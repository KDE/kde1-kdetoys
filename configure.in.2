
if test ! -s ./inst-apps && test -s ./SUBDIRS; then
 cp ./SUBDIRS ./inst-apps
fi

DO_NOT_COMPILE="$DO_NOT_COMPILE CVS debian bsd-port admin"

if test ! -s ./inst-apps; then
  TOPSUBDIRS=""
# this needs a good find. But only developers should need this case, since
# distribution comes with SUBDIRS
  files=`ls -1`
  dirs=`for i in $files; do if test -d $i; then echo $i; fi; done`
  for i in $dirs; do 
    echo $i >> ./SUBDIRS
  done
  cp ./SUBDIRS ./inst-apps
fi    

if test -s ./inst-apps; then
  ac_topsubdirs="`cat ./inst-apps`"
fi  

for i in $ac_topsubdirs; do
  AC_MSG_CHECKING([if $i should be compiled])
  install_it="yes"
  for j in $DO_NOT_COMPILE; do 
    if test $i = $j; then
      install_it="no"
    fi
  done
  AC_MSG_RESULT($install_it)
  if test $install_it = "yes"; then 
    TOPSUBDIRS="$TOPSUBDIRS $i"
  fi
done

AC_SUBST(TOPSUBDIRS)

ac_output=`find $TOPSUBDIRS -name Makefile.in -print | sed -e 's/.in$//;' | sort`
AC_OUTPUT($ac_output Makefile)

